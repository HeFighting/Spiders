/**
 * Created by python on 17-9-16.
 */
function loginValidate(e){return""==e.phoneNum?{flag:!3,msg:"账号不能为空"}:""==e.password?{flag:!1,msg:"密码不能为空"}:{flag:!0}}function toast(e,t,n){var o=document.createElement("div");o.className="toast",o.innerHTML=e.replace(/\\n/g,"<br />"),$("body").appendChild(o),clearTimeout(r);var r=setTimeout(function(){if($(".toast"))if($(".toast").length>1)for(var e=0;e<$(".toast").length;e++)$(".toast")[e].parentNode.removeChild($(".toast")[e]);else $(".toast").parentNode.removeChild($(".toast"));"function"==typeof n&&n()},t||1500)}function initREM(){function e(t){var n=window.innerWidth;$("html").style.fontSize=.15625*n+"px",n>window.screen.width&&10>=t?e(++t):$("body").style.opacity=1}window.onresize=e,setTimeout(function(){e(0)},1)}function ajaxFunc(e,t,n,o){var r="string"==typeof n?n:Object.keys(n).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(n[e])}).join("&"),i=new XMLHttpRequest;return i.open(e,t),i.onreadystatechange=function(){i.readyState>3&&200==i.status&&o(i.responseText)},i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(r),i}function $(e,t){var n=(t||document).querySelectorAll(e);return 1===n.length||0===n.length?n[0]:n}function getQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null}function test(e,t){ajaxFunc("get","http://activity.renren.com/livecell/rKeytest?dp="+e+"&rKey="+t,"",function(e){console.log(e)})}function login1(e,t){$(".w-login-bottom").addEventListener("click",function(e){"w-login-qq"==e.target.className&&(location.href="http://activity.renren.com/authInfo?type=0&uri="+localStorage.getItem("url")||"http://activity.renren.com/home"),"w-login-weibo"==e.target.className&&(location.href="http://activity.renren.com/authInfo?type=1&uri="+localStorage.getItem("url")||"http://activity.renren.com/home")})}window.passwordInfo={},window.login={init:function(){initREM(),this.resetHref(),this.formSubmit(),login1()},resetHref:function(){window.c1=getQueryString("c1");for(var e=$(".js-register"),t=0;t<e.length;t++)e[t].href="http://activity.renren.com/livecell/reg?c1="+c1},formSubmit:function(){var e,t={};$(".login").addEventListener("click",function(){t.phoneNum=$(".phonenum").value,t.password=$(".password").value,e=loginValidate(t),t.c1=c1||0,e.flag?ajaxFunc("get","http://activity.renren.com/livecell/rKey","",function(e){var n=JSON.parse(e).data;if(0==n.code){t.password=t.password.split("").reverse().join(""),setMaxDigits(130);var o=new RSAKeyPair(n.e,"",n.n),r=encryptedString(o,t.password);t.password=r,t.rKey=n.rkey}else toast("公钥获取失败"),t.rKey="";ajaxFunc("post","http://activity.renren.com/livecell/ajax/clog",t,function(e){var e=JSON.parse(e).logInfo;0==e.code?location.href=localStorage.getItem("url")||"":toast(e.msg||"登录出错")})}):toast(e.msg)})}};
